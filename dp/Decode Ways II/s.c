#include <stdio.h>
#include <stdbool.h>
#include <string.h>


// 一个坑：精度
// p[i] = p[i-1] *pcc[s[i]] + p[i-2]*cc[s[i-1]][s[i]]
// pcc values
// s[i] | value
// -----+------
//   *  |  9
//   0  |  0
//  1-9 |  1
//
// cc values
// s[i-1] |   s[i] | value
// -------+--------+-------
//    *   |   *    |  15
//    *   |  1-6   |  2
//    *   |  2-9   |  1
//    0   |  *,0-9 |  0
//    1   |   *    |  9
//    2   |   *    |  6
//  3-9   | *,0-9  |  0

int numDecodings(char* s) {
  size_t p[2], m;
  size_t l = strlen(s);

  p[0] = *s == '0' ? 0 : (*s == '*' ? 9 : 1); p[1] = 1;

#define I(c) ((c)-'*')
#define SIZE ('9'-'*'+1)
  size_t cc[SIZE][SIZE] = {
    {15,0,0,0,0,0,2,2,2,2,2,2,2,1,1,1,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {9,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,},
    {6,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
  };

  size_t pcc[SIZE] ={9,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,};

#define C 1000000007
#define M(m) ((m) % C)

  for (size_t i = 1; i < l; i++) {
    m = pcc[I(s[i])] * p[0] + p[1] * cc[I(s[i-1])][I(s[i])];
    p[1] = p[0];
    p[0] = M(m);
  }

  return p[0];
}

int main(void) {
  char *s = "1*";
  printf("%s, %d\n", s, numDecodings(s));
  s = "*";
  printf("%s, %d\n", s, numDecodings(s));
  s = "**";
  printf("%s, %d\n", s, numDecodings(s));
  s = "*1";
  printf("%s, %d\n", s, numDecodings(s));
  s = "*1*1*0";
  printf("%s, %d\n", s, numDecodings(s));
  s = "*0**0";
  printf("%s, %d\n", s, numDecodings(s));
  s ="**********1111111111";
  printf("%s, %d\n", s, numDecodings(s));
}
